<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">페이지 제목</title>
    <style>
        /* 스타일 부분은 여기에 추가 */

        input {
            width: auto;
            box-sizing: border-box;
            margin-top: 10px;

        }

    </style>
</head>
<body>
<form action="/api/v1/issue/add" th:object="${dto}" method="post">
    <!-- 입력 필드 -->
    <input type="hidden" id="crawlingNo" th:field="*{crawlingNo}" th:value="${crawlingNo}">
    <div>
        <label th:for="title">제목 : </label>
        <input type="text" id="title" th:field="*{title}" th:value="${title}">
    </div>

    <label th:for="content">내용 : </label>
    <textarea name="content" cols="40" rows="8" th:field="*{content}" th:value="${content}">
    내용이 들어갈껍니다.
    </textarea>
    <!--<div>
    <label th:for="date">날짜 : </label>
    <input type="text" id="date" th:field="*{date}" th:value="${date}"required>
    </div>-->

        <div class="dynamicFields">
            <div>
                <label th:for="line">호선 : </label>
                <select class="selectedLine" onchange="updateStations(this)">
                    <option value="1호선">1호선</option>
                    <option value="2호선">2호선</option>
                    <option value="3호선">3호선</option>
                    <option value="4호선">4호선</option>
                    <option value="5호선">5호선</option>
                    <option value="6호선">6호선</option>
                    <option value="7호선">7호선</option>
                    <option value="8호선">8호선</option>
                </select>

                <label th:for="stations">출발역 : </label>
                <select name="selectedStations" class="selectedStations">
                    <!-- 선택된 호선에 따라 동적으로 업데이트될 영역 -->
                </select>

                <label th:for="stations">도착역 : </label>
                <select name="selectedStations" class="selectedStations">
                    <!-- 선택된 호선에 따라 동적으로 업데이트될 영역 -->
                </select>
            </div>
        </div>


    <button type="button" onclick="addNewLine()">추가라는 버튼</button>
    <div>
        <label th:for="expireDate"> 시작일자 : </label>
        <input type="datetime-local"  id="startDate" th:field="*{startDate}" >
        <label th:for="expireDate"> 종료예정일자 : </label>
        <input type="datetime-local"  id="expireDate" th:field="*{expireDate}" >
    </div>
    <label th:for="secretCode">관리자 인증 코드 : </label>
    <input type="password" id="secretCode" th:field="*{secretCode}">
    <button type="submit">제출</button>
</form>
</body>
<script th:inline="javascript">
    function updateStations(selectedLineElement) {
        console.log("함수호출 제대로 되나융")
        var selectedLine = selectedLineElement.value;
        if(selectedLine) {
            fetch('/api/v1/stations?line=' + selectedLine)
                .then(response => response.json())
                .then(data => {
                    var stationList = selectedLineElement.parentElement.querySelectorAll('.selectedStations');
                    stationList.forEach(stationList => {
                        stationList.innerHTML = ''; // 기존의 역들을 모두 제거
                        data.forEach(station => {
                            var option = document.createElement('option');
                            option.value = station.stationCode;
                            option.textContent = station.name;
                            stationList.appendChild(option);
                        });
                    });

                });
        } else {
            var stationList = selectedLineElement.parentElement.querySelectorAll('.selectedStations');
            stationList.forEach(stationList => {
                stationList.innerHTML = ''; // 호선이 선택되지 않은 경우, 역들을 모두 제거
            });
        }
    }

    function addNewLine() {
        var container = document.createElement('div');
        container.classList.add('dynamicFields');

        var lineLabel = document.createElement('label');
        lineLabel.textContent = '호선: ';
        container.appendChild(lineLabel);

        var lineSelect = document.createElement('select');
        lineSelect.setAttribute('onchange', 'updateStations(this)');
        lineSelect.classList.add('selectedLine');
        ['1호선', '2호선', '3호선', '4호선', '5호선', '6호선', '7호선', '8호선'].forEach(function (line) {
            var option = document.createElement('option');
            option.value = line;
            option.textContent = line;
            lineSelect.appendChild(option);
        });
        container.appendChild(lineSelect);

        var startLabel = document.createElement('label');
        startLabel.textContent = '출발역: ';
        container.appendChild(startLabel);

        var startSelect = document.createElement('select');
        startSelect.name = 'selectedStations';
        startSelect.classList.add('selectedStations');
        container.appendChild(startSelect);

        var endLabel = document.createElement('label');
        endLabel.textContent = '도착역: ';
        container.appendChild(endLabel);

        var endSelect = document.createElement('select');
        endSelect.name = 'selectedStations';
        endSelect.classList.add('selectedStations');
        container.appendChild(endSelect);

        var addButton = document.querySelector('button');
        addButton.parentElement.insertBefore(container, addButton);
    }
</script>

</html>
``
